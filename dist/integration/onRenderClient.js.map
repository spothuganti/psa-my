{"version":3,"file":"onRenderClient.js","sources":["../../src/integration/onRenderClient.ts"],"sourcesContent":["// https://vike.dev/onRenderClient\r\nexport { onRenderClient }\r\n\r\nimport { createVueApp, type ChangePage } from './createVueApp.js'\r\nimport { getHeadSetting } from './getHeadSetting.js'\r\nimport type { OnRenderClientAsync, PageContextClient } from 'vike/types'\r\nimport { callCumulativeHooks } from '../utils/callCumulativeHooks.js'\r\nimport type { App } from 'vue'\r\nimport { objectAssign } from '../utils/objectAssign.js'\r\nimport type { PageContextInternal } from '../types/PageContext.js'\r\nimport { applyHeadSettings } from './applyHeadSettings.js'\r\n\r\nlet app: App | undefined\r\nlet changePage: ChangePage | undefined\r\nconst onRenderClient: OnRenderClientAsync = async (\r\n  pageContext: PageContextClient & PageContextInternal,\r\n): ReturnType<OnRenderClientAsync> => {\r\n  // Workaround for https://github.com/vikejs/vike-vue/pull/178#issuecomment-2285852251b\r\n  pageContext._configFromHook ??= {}\r\n  // Workaround for https://github.com/vikejs/vike-vue/issues/181\r\n  pageContext._headAlreadySetWrapper = { val: pageContext.isHydration }\r\n\r\n  // Or eventually use https://github.com/vikejs/vike/issues/1776\r\n  pageContext.isRenderingHead = undefined\r\n\r\n  if (!app) {\r\n    // First rendering/hydration\r\n\r\n    const container = document.getElementById('app')!\r\n    const ssr = container.innerHTML !== ''\r\n    const res = await createVueApp(pageContext, ssr, 'Page')\r\n    changePage = res.changePage\r\n    app = res.app\r\n    objectAssign(pageContext, { app })\r\n    await callCumulativeHooks(pageContext.config.onBeforeRenderClient, pageContext)\r\n    app.mount(container)\r\n  } else {\r\n    // Client-side navigation\r\n\r\n    objectAssign(pageContext, { app })\r\n    await callCumulativeHooks(pageContext.config.onBeforeRenderClient, pageContext)\r\n    await changePage!(pageContext)\r\n  }\r\n\r\n  if (!pageContext.isHydration) {\r\n    pageContext._headAlreadySetWrapper!.val = true\r\n    applyHead(pageContext)\r\n  }\r\n\r\n  // Use cases:\r\n  // - Custom user settings: https://vike.dev/head-tags#custom-settings\r\n  // - Testing tools: https://github.com/vikejs/vike-react/issues/95\r\n  await callCumulativeHooks(pageContext.config.onAfterRenderClient, pageContext)\r\n}\r\n\r\nfunction applyHead(pageContext: PageContextClient) {\r\n  const title = getHeadSetting<string | null>('title', pageContext)\r\n  const lang = getHeadSetting<string | null>('lang', pageContext)\r\n  applyHeadSettings(title, lang)\r\n}\r\n"],"names":[],"mappings":";;AAYA,IAAI;AACJ,IAAI;AACE,MAAA,iBAAsC,OAC1C,gBACoC;AAEpC,cAAY,oBAAZ,YAAY,kBAAoB;AAEhC,cAAY,yBAAyB,EAAE,KAAK,YAAY,YAAY;AAGpE,cAAY,kBAAkB;AAE9B,MAAI,CAAC,KAAK;AAGF,UAAA,YAAY,SAAS,eAAe,KAAK;AACzC,UAAA,MAAM,UAAU,cAAc;AACpC,UAAM,MAAM,MAAM,aAAa,aAAa,KAAK,MAAM;AACvD,iBAAa,IAAI;AACjB,UAAM,IAAI;AACG,iBAAA,aAAa,EAAE,IAAA,CAAK;AACjC,UAAM,oBAAoB,YAAY,OAAO,sBAAsB,WAAW;AAC9E,QAAI,MAAM,SAAS;AAAA,EAAA,OACd;AAGQ,iBAAA,aAAa,EAAE,IAAA,CAAK;AACjC,UAAM,oBAAoB,YAAY,OAAO,sBAAsB,WAAW;AAC9E,UAAM,WAAY,WAAW;AAAA,EAC/B;AAEI,MAAA,CAAC,YAAY,aAAa;AAC5B,gBAAY,uBAAwB,MAAM;AAC1C,cAAU,WAAW;AAAA,EACvB;AAKA,QAAM,oBAAoB,YAAY,OAAO,qBAAqB,WAAW;AAC/E;AAEA,SAAS,UAAU,aAAgC;AAC3C,QAAA,QAAQ,eAA8B,SAAS,WAAW;AAC1D,QAAA,OAAO,eAA8B,QAAQ,WAAW;AAC9D,oBAAkB,OAAO,IAAI;AAC/B;"}