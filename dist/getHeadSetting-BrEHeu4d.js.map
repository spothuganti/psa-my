{"version":3,"file":"getHeadSetting-BrEHeu4d.js","sources":["../src/utils/objectAssign.ts","../src/utils/callCumulativeHooks.ts","../src/utils/isPlainObject.ts","../src/integration/createVueApp.ts","../src/utils/isCallable.ts","../src/integration/getHeadSetting.ts"],"sourcesContent":["// Same as `Object.assign()` but with type inference\r\nexport function objectAssign<Obj extends object, ObjAddendum>(\r\n  obj: Obj,\r\n  objAddendum: ObjAddendum,\r\n): asserts obj is Obj & ObjAddendum {\r\n  Object.assign(obj, objAddendum)\r\n}\r\n","export { callCumulativeHooks }\r\n\r\nimport { providePageContext } from 'vike/getPageContext'\r\n\r\nasync function callCumulativeHooks(\r\n  values: undefined | unknown[],\r\n  pageContext: Record<string, any>,\r\n): Promise<unknown[]> {\r\n  if (!values) return []\r\n  const valuesPromises = values.map((val) => {\r\n    if (typeof val === 'function') {\r\n      providePageContext(pageContext)\r\n      // Hook\r\n      return val(pageContext)\r\n    } else {\r\n      // Plain value\r\n      return val\r\n    }\r\n  })\r\n  const valuesResolved = await Promise.all(valuesPromises)\r\n  return valuesResolved\r\n}\r\n","export function isPlainObject(value: unknown): value is Record<string, unknown> {\r\n  // Is object?\r\n  if (typeof value !== 'object' || value === null) {\r\n    return false\r\n  }\r\n\r\n  // Support `Object.create(null)`\r\n  if (Object.getPrototypeOf(value) === null) {\r\n    return true\r\n  }\r\n\r\n  // Is plain object?\r\n  return (\r\n    /* Doesn't work in Cloudflare Pages workers\r\n    value.constructor === Object\r\n    */\r\n    value.constructor.name === 'Object'\r\n  )\r\n}\r\n","export { createVueApp }\r\nexport type { ChangePage }\r\n\r\nimport {\r\n  type App,\r\n  createApp,\r\n  createSSRApp,\r\n  h,\r\n  nextTick,\r\n  shallowRef,\r\n  shallowReactive,\r\n  type Component,\r\n  Fragment,\r\n} from 'vue'\r\nimport type { PageContext } from 'vike/types'\r\nimport { setPageContext } from '../hooks/usePageContext'\r\nimport { objectAssign } from '../utils/objectAssign'\r\nimport { callCumulativeHooks } from '../utils/callCumulativeHooks'\r\nimport { isPlainObject } from '../utils/isPlainObject'\r\nimport { setData } from '../hooks/useData'\r\nimport type { PageContextInternal } from '../types/PageContext'\r\n\r\ntype ChangePage = (pageContext: PageContext) => Promise<void>\r\nasync function createVueApp(\r\n  pageContext: PageContext & PageContextInternal,\r\n  ssr: boolean,\r\n  entryComponentName: 'Head' | 'Page',\r\n) {\r\n  let onChangePage: undefined | ((pageContext: PageContext) => void)\r\n  let RootComponent: Component | (() => ReturnType<typeof h>)\r\n  // Wrap <Page> with <Layout>\r\n  if (entryComponentName === 'Page') {\r\n    const entryComponentRef = shallowRef(pageContext.config[entryComponentName])\r\n    const layoutRef = shallowRef(pageContext.config.Layout || [])\r\n    onChangePage = (pageContext: PageContext) => {\r\n      entryComponentRef.value = pageContext.config[entryComponentName]\r\n      layoutRef.value = pageContext.config.Layout || []\r\n    }\r\n    const EntryComponent = () => h(entryComponentRef.value)\r\n    RootComponent = () => {\r\n      let RootComp = EntryComponent\r\n      layoutRef.value.forEach((layout) => {\r\n        const Comp = RootComp\r\n        RootComp = () => h(layout, null, Comp)\r\n      })\r\n      return RootComp()\r\n    }\r\n  } else {\r\n    RootComponent = () => {\r\n      const HeadElements = [\r\n        // Added by +Head\r\n        ...(pageContext.config.Head ?? []),\r\n        // Added by useConfig()\r\n        ...(pageContext._configFromHook?.Head ?? []),\r\n      ].map((HeadComponent) => h(HeadComponent))\r\n      return h(Fragment, null, HeadElements)\r\n    }\r\n  }\r\n\r\n  const app: App = ssr ? createSSRApp(RootComponent) : createApp(RootComponent)\r\n  objectAssign(pageContext, { app })\r\n  const { onCreateApp } = pageContext.config\r\n  await callCumulativeHooks(onCreateApp, pageContext)\r\n\r\n  const data = pageContext.data ?? {}\r\n  assertDataIsObject(data)\r\n  // TODO/breaking-change: use shallowRef() instead of shallowReactive()\r\n  // - Remove workaround https://github.com/vikejs/vike-vue/blob/89ca09ed18ffa1c0401851a506f505813a7dece7/packages/vike-vue/src/integration/onRenderClient.ts#L18-L21\r\n  const dataReactive = shallowReactive(data)\r\n  const pageContextReactive = shallowReactive(pageContext)\r\n  setPageContext(app, pageContextReactive)\r\n  setData(app, dataReactive)\r\n\r\n  // changePage() is called upon navigation, see +onRenderClient.ts\r\n  const changePage: ChangePage = async (pageContext: PageContext) => {\r\n    let returned = false\r\n    let err: unknown\r\n    app.config.errorHandler = (err_) => {\r\n      if (returned) {\r\n        console.error(err_)\r\n      } else {\r\n        err = err_\r\n      }\r\n    }\r\n    const data = pageContext.data ?? {}\r\n    assertDataIsObject(data)\r\n    objectReplace(dataReactive, data)\r\n    objectReplace(pageContextReactive, pageContext)\r\n    onChangePage?.(pageContext)\r\n    await nextTick()\r\n    returned = true\r\n    if (err) throw err\r\n  }\r\n\r\n  return { app, changePage }\r\n}\r\n\r\nfunction assertDataIsObject(data: unknown): asserts data is Record<string, unknown> {\r\n  if (!isPlainObject(data)) throw new Error('data() should return a plain object, undefined, or null')\r\n}\r\n\r\nexport function objectReplace(obj: object, objAddendum: object) {\r\n  // @ts-ignore\r\n  Object.keys(obj).forEach((key) => delete obj[key])\r\n  Object.assign(obj, objAddendum)\r\n}\r\n","export function isCallable<T extends (...args: unknown[]) => unknown>(thing: T | unknown): thing is T {\r\n  return thing instanceof Function || typeof thing === 'function'\r\n}\r\n","export { getHeadSetting }\r\n\r\nimport { isCallable } from '../utils/isCallable.js'\r\nimport type { PageContext } from 'vike/types'\r\nimport type { PageContextInternal } from '../types/PageContext.js'\r\nimport type { ConfigFromHookResolved } from '../types/Config.js'\r\nimport { configsCumulative } from '../hooks/useConfig/configsCumulative.js'\r\nimport { includes } from '../utils/includes.js'\r\n\r\n// We use `any` instead of doing proper validation in order to save KBs sent to the client-side.\r\n\r\nfunction getHeadSetting<T>(\r\n  configName: keyof ConfigFromHookResolved,\r\n  pageContext: PageContext & PageContextInternal,\r\n): undefined | T {\r\n  // Set by useConfig()\r\n  const valFromUseConfig = pageContext._configFromHook?.[configName]\r\n  // Set by +configName.js\r\n  const valFromConfig = pageContext.config[configName]\r\n\r\n  const getCallable = (val: unknown) => (isCallable(val) ? val(pageContext) : val)\r\n  if (!includes(configsCumulative, configName)) {\r\n    if (valFromUseConfig !== undefined) return valFromUseConfig as any\r\n    return getCallable(valFromConfig) as any\r\n  } else {\r\n    return [\r\n      //\r\n      ...((valFromConfig as any) ?? []).map(getCallable),\r\n      ...((valFromUseConfig as any) ?? []),\r\n    ] as any\r\n  }\r\n}\r\n"],"names":["pageContext","data"],"mappings":"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"}